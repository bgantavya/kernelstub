# Kernel Option Selector

This script helps identify the latest and previous kernel and initrd images from a specified directory, typically `/boot`.

## Folder Structure

- `/`
  - `kernel_option.py`

## Description

The `kernel_option.py` script provides functions to parse a directory (defaulting to `/boot`) for kernel (`vmlinuz-*`) and initial ramdisk (`initrd.img-*`) files. It then identifies the most recent kernel/initrd pair and the next most recent pair, making it useful for bootloader configuration or system management tasks.

## How to Use

### Installation

This script is written in Python 3 and relies on the `debian.changelog` module, which is part of the `python3-debian` package.

```bash
sudo apt-get update
sudo apt-get install python3-debian
```

### Usage

The script can be run directly from the command line. It accepts an optional path argument for the directory to scan. If no argument is provided, it defaults to `/boot`.

**Example:**

To find the latest and previous kernel options in the default `/boot` directory:

```bash
python3 kernel_option.py
```

This will output a tuple containing two dictionaries, representing the latest and previous kernel/initrd options. Each dictionary maps `'kernel'` and `'initrd'` to their respective file paths.

**Example Output:**

```
({'/boot/vmlinuz-5.15.0-84-generic': '/boot/vmlinuz-5.15.0-84-generic', '/boot/initrd.img-5.15.0-84-generic': '/boot/initrd.img-5.15.0-84-generic'}, {'/boot/vmlinuz-5.15.0-76-generic': '/boot/vmlinuz-5.15.0-76-generic', '/boot/initrd.img-5.15.0-76-generic': '/boot/initrd.img-5.15.0-76-generic'})
```

### Functions

- `options(path)`: Scans the given `path` for kernel and initrd files and returns a dictionary categorized by version.
- `get_newest_option(opts)`: Identifies the newest complete kernel/initrd pair from a list of options.
- `latest_option(path)`: Orchestrates the process, returning the latest and previous kernel/initrd options.

## Technologies Used

- **Python 3**: The primary programming language.
- **`debian.changelog`**: Used for version comparison (`Version` class).
- **`os` module**: For interacting with the operating system, such as listing directory contents and joining paths.

## Architecture or Code Overview

The script works in three main steps:

1.  **`options(path)`**: This function iterates through all files in the specified `path`. It identifies files starting with `vmlinuz-` or `initrd.img-`. For each identified file, it extracts the version string and organizes the kernel and initrd paths into a dictionary where keys are version numbers and values are dictionaries containing `'kernel'` and `'initrd'` entries.

2.  **`get_newest_option(opts)`**: This function takes the dictionary generated by `options`. It iterates through the versions, using `debian.changelog.Version` to perform accurate version comparisons. It returns the option (kernel and initrd paths) corresponding to the highest version number, provided it's a complete set (both kernel and initrd are present).

3.  **`latest_option(path)`**: This is the main logic function. It first calls `options` to get all available kernel/initrd pairs. Then, it calls `get_newest_option` to find the absolute latest option. It temporarily removes the latest option from the list and then calls `get_newest_option` again on the remaining options to find the second latest (previous) option. It returns both the latest and previous options.

The `if __name__ == "__main__":` block demonstrates how to call the `latest_option` function with the default `/boot` path and prints the result.

## Known Issues / Improvements

*   **Error Handling**: The script does not explicitly handle cases where the `/boot` directory might not exist or if there are permission issues.
*   **Incomplete Pairs**: While `get_newest_option` skips incomplete pairs (missing kernel or initrd for a version), the output format doesn't explicitly distinguish if a returned option is incomplete.
*   **External Dependencies**: Relies on `python3-debian`. A pure Python solution for version comparison could make it more portable.
*   **More than two options**: The script only returns the latest and second latest. It could be extended to return a list of all available, complete kernel/initrd pairs.

## Additional Notes or References

*   **Licensing**: No license information is provided.
*   **Credits**: No specific authors are listed beyond "Anonymous" in the original context.